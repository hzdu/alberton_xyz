!function($){"use strict";var iaa_isLinking=!1,iaa_links=new Array,iaa_linkCurrentIndex=-1,iaa_canvasTimer,iaa_mouseX,iaa_mouseY,iaa_linkGradientIndex=1,iaa_itemWinTimer,iaa_currentDomElement=!1,iaa_currentStep=!1,iaa_defaultStep=!1,iaa_steps=!1,iaa_params,iaa_lock=!1,iaa_currentLinkIndex=0,iaa_settings,iaa_formfield,iaa_canSaveLink=!0;function iaa_autoSaveSettings(){sessionStorage.openSettings=1,iaa_saveSettings()}function iaa_loadSteps(){jQuery("#iaa_stepsContainer .iaa_stepBloc,.iaa_loadSteps,.iaa_linkPoint").remove(),jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_loadSteps"},success:function(a){a=JSON.parse(a),iaa_params=a.params,iaa_steps=a.steps,jQuery.each(a.steps,function(a){var e=this;e.content=JSON.parse(e.content),iaa_addStep(e)}),jQuery.each(a.links,function(a){var e=this;e.originID=jQuery('.iaa_stepBloc[data-stepid="'+e.originID+'"]').attr("id"),e.destinationID=jQuery('.iaa_stepBloc[data-stepid="'+e.destinationID+'"]').attr("id"),e.conditions=JSON.parse(e.conditions),iaa_links[a]=e}),jQuery("#iaa_loader").fadeOut()}})}function iaa_getStepByID(e){var t=!1;return jQuery.each(iaa_steps,function(a){this.id==e&&(t=this)}),t}function iaa_addStep(a){var e="",t=0,e=a.content?a.content.title:a,i=jQuery('<div class="iaa_stepBloc palette palette-clouds"><div class="iaa_stepBlocWrapper"><h4>'+e+'</h4></div><a href="javascript:" class="iaa_btnEdit"><span class="glyphicon glyphicon-pencil"></span></a><a href="javascript:" class="iaa_btnSup"><span class="glyphicon glyphicon-trash"></span></a><a href="javascript:" class="iaa_btnLink"><span class="glyphicon glyphicon-link"></span></a><a href="javascript:" class="iaa_btnStart"><span class="glyphicon glyphicon-flag"></span></a></div>');a.content&&1==a.content.start&&(i.find(".iaa_btnStart").addClass("iaa_selected"),i.addClass("iaa_selected")),a.elementID?i.attr("id",a.elementID):i.uniqueId(),i.children("a.iaa_btnEdit").click(function(){iaa_openWinStep(jQuery(this).parent().attr("data-stepid"))}),i.children("a.iaa_btnLink").click(function(){iaa_startLink(jQuery(this).parent().attr("id"))}),i.children("a.iaa_btnSup").click(function(){iaa_removeStep(jQuery(this).parent().attr("data-stepid"))}),i.children("a.iaa_btnStart").click(function(){jQuery(".iaa_stepBloc[data-stepid]").find(".iaa_btnStart").removeClass("iaa_selected"),jQuery(".iaa_stepBloc[data-stepid]").find(".iaa_btnStart").closest(".iaa_stepBloc").removeClass("iaa_selected"),jQuery.each(iaa_steps,function(){var a=this;a.id!=jQuery(this).parent().attr("data-stepid")&&1==a.content.start&&(a.content.start=0,jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_saveStep",step:JSON.stringify(a.content)},success:function(){iaa_loadSteps()}}))}),jQuery(this).addClass("iaa_selected"),jQuery(this).closest(".iaa_stepBloc").addClass("iaa_selected");var a=iaa_getStepByID(jQuery(this).parent().attr("data-stepid"));a.content.start=1,jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_saveStep",step:JSON.stringify(a.content)}})}),i.draggable({containment:"parent",handle:".iaa_stepBlocWrapper"}),i.children(".iaa_stepBlocWrapper").click(function(){iaa_isLinking&&iaa_stopLink(i)});var n=10,e=10,e=a.content&&a.content.previewPosX?(n=a.content.previewPosX,a.content.previewPosY):(n=jQuery("#iaa_stepsOverflow").scrollLeft()+jQuery("#iaa_stepsOverflow").width()/2-64,jQuery("#iaa_stepsOverflow").scrollTop()+jQuery("#iaa_stepsOverflow").height()/2-64);i.hide(),jQuery("#iaa_stepsContainer").append(i),i.css({left:n+"px",top:e+"px"}),i.fadeIn(),iaa_updateStepsDesign(),jQuery(".iaa_btnWinClose").parent().click(function(){iaa_closeWin(jQuery(this).parents(".iaa_window"))}),0==iaa_steps.length&&(t=1),a.id?i.attr("data-stepid",a.id):jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_addStep",elementID:i.attr("id"),previewPosX:n,previewPosY:e,start:t},success:function(a){a=jQuery.parseJSON(a),i.attr("data-stepid",a.id),1==a.start&&(i.find(".iaa_btnStart").addClass("iaa_selected"),i.addClass("iaa_selected")),iaa_steps.push({content:a})}})}function iaa_removeStep(a){jQuery('.iaa_stepBloc[data-stepid="'+a+'"]').remove(),jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_removeStep",stepID:a},success:function(){}})}function iaa_updateStepsDesign(){jQuery("#wpwrap").css({height:jQuery("#iaa_bootstraped").height()+48}),jQuery("#iaa_stepsCanvas").attr("width",jQuery("#iaa_stepsContainer").outerWidth()),jQuery("#iaa_stepsCanvas").attr("height",jQuery("#iaa_stepsContainer").outerHeight()),jQuery("#iaa_stepsCanvas").css({width:jQuery("#iaa_stepsContainer").outerWidth(),height:jQuery("#iaa_stepsContainer").outerHeight()}),jQuery("#iaa_stepsContainer .iaa_stepBloc > .iaa_stepBlocWrapper > h4").each(function(){jQuery(this).css("margin-top",0-jQuery(this).height()/2)})}function iaa_repositionLinkPoint(e){var t=iaa_links[e],a=jQuery("#"+t.originID).offset().left-jQuery("#iaa_stepsContainer").offset().left+jQuery("#"+t.originID).width()/2,i=jQuery("#"+t.originID).offset().top-jQuery("#iaa_stepsContainer").offset().top+jQuery("#"+t.originID).height()/2,n=jQuery("#"+t.destinationID).offset().left-jQuery("#iaa_stepsContainer").offset().left+jQuery("#"+t.destinationID).width()/2,r=jQuery("#"+t.destinationID).offset().top-jQuery("#iaa_stepsContainer").offset().top+jQuery("#"+t.destinationID).height()/2,o=a+(n-a)/2,s=i+(r-i)/2;jQuery.each(iaa_links,function(a){this.originID==t.destinationID&&this.destinationID==t.originID&&a<e&&(o+=15,s+=15)}),jQuery('.iaa_linkPoint[data-linkindex="'+e+'"]').css({left:o+"px",top:s+"px"})}function iaa_loadSettings(){jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_loadSettings"},success:function(a){a=jQuery.parseJSON(a),iaa_settings=a,jQuery('.iaa_avatarContainer [data-type="corpse"]').attr("data-num",a.avatar_corpse),jQuery('.iaa_avatarContainer [data-type="hair"]').attr("data-num",a.avatar_hair),jQuery('.iaa_avatarContainer [data-type="head"]').attr("data-num",a.avatar_head),jQuery('.iaa_avatarContainer [data-type="eyes"]').attr("data-num",a.avatar_eyes),jQuery('.iaa_avatarContainer [data-type="mouth"]').attr("data-num",a.avatar_mouth),jQuery("#iaa_settings_position").val(a.positionScreen),jQuery("#iaa_settings_initialText").val(a.initialText),jQuery("#iaa_settings_enable").val(a.enabled),jQuery("#iaa_settings_hideOnClose").val(a.hideOnClose),jQuery("#iaa_settings_colorBubble").val(a.colorBubble),jQuery("#iaa_settings_colorText").val(a.colorText),jQuery("#iaa_settings_colorButtons").val(a.colorButtons),jQuery("#iaa_settings_colorButtonsText").val(a.colorButtonsText),jQuery("#iaa_settings_colorShine").val(a.colorShine),jQuery("#iaa_settings_avatarType").val(a.avatarType),jQuery("#iaa_settings_disableIntro").val(a.disableIntro),jQuery("#iaa_settings_useWPML").val(a.useWPML),jQuery("#iaa_settings_disableMobile").val(a.disableMobile),iaa_settings.avatarType&&jQuery("#iaa_avatarCustomPreviewContent img").load(function(){iaa_settings_updatePreviewCustomAvatar()}),iaa_settings_updatePreviewCustomAvatar(),sessionStorage.openSettings&&1==sessionStorage.openSettings&&(sessionStorage.openSettings=0,iaa_openSettings())}})}function iaa_settings_updatePreviewCustomAvatar(){"1"==jQuery("#iaa_settings_avatarType").val()?(jQuery(".iaa_avatarContainer").addClass("iaa_customAvatar"),0<jQuery("#iaa_avatarCustomPreviewContent").width()?(jQuery(".iaa_avatarContainer").css({width:jQuery("#iaa_avatarCustomPreviewContent").width()+"px",height:jQuery("#iaa_avatarCustomPreviewContent").height()+"px"}),jQuery(".iaa_avatarContainer").append('<img class="iaa_avatar_img" style="width: 100%; height: 100%; position: relative;" src="'+jQuery("#iaa_avatarCustomPreviewContent > img:eq(0)").attr("src")+'" />'),jQuery(".iaa_avatarContainer").append('<img class="iaa_avatar_mouth" style="left:'+jQuery("#iaa_avatarCustomPreviewContent").width()/2+"px; margin-left: -"+jQuery("#iaa_avatarCustomPreview_mouth").width()/2+'px;" src="'+jQuery("#iaa_avatarCustomPreviewContent > img:eq(1)").attr("src")+'" />'),jQuery(".iaa_avatarContainer img.iaa_avatar_mouth").css({top:jQuery("#iaa_avatarCustomPreviewContent > img:eq(1)").css("top")}),jQuery("#iaa_avatarCustomPreview_mouth").css({left:"50%",top:jQuery("#iaa_avatarCustomPreviewContent > img:eq(1)").css("top"),marginLeft:0-jQuery("#iaa_avatarCustomPreview_mouth").width()/2+"px"})):(jQuery(".iaa_avatarContainer").css({width:iaa_settings.avatarWidth+"px",height:iaa_settings.avatarHeight+"px"}),jQuery(".iaa_avatarContainer").append('<img class="iaa_avatar_img" style="width: 100%; height: 100%; position: relative;" src="'+iaa_settings.avatarImg+'" />'),jQuery(".iaa_avatarContainer").append('<img class="iaa_avatar_mouth" style="left:'+iaa_settings.avatarWidth/2+"px; margin-left: -"+iaa_settings.avatarMouthWidth/2+'px;" src="'+iaa_settings.avatarTalkImg+'" />'),jQuery(".iaa_avatarContainer img.iaa_avatar_mouth").css({top:iaa_settings.avatarMouthY+"px"}),jQuery("#iaa_avatarCustomPreview_mouth").css({left:"50%",top:iaa_settings.avatarMouthY+"px",marginLeft:0-jQuery("#iaa_avatarCustomPreview_mouth").width()/2+"px"}))):(jQuery(".iaa_avatarContainer img").remove(),jQuery(".iaa_avatarContainer").removeClass("iaa_customAvatar"),jQuery(".iaa_avatarContainer").css({width:128,height:146}),jQuery("#iaa_bootstraped.iaa_bootstraped .iaa_talkBubble").css({bottom:"96px"})),jQuery("#iaa_talkBubble").each(function(){jQuery(this).css({bottom:parseInt(jQuery(this).closest(".iaa_avatarContainer").css("height"))+13})})}function iaa_openSettings(){1==iaa_settings.avatarType?(jQuery("#iaa_avatarDefault").hide(),jQuery("#iaa_avatarCustom").show()):(jQuery("#iaa_avatarDefault").show(),jQuery("#iaa_avatarCustom").hide()),jQuery("#iaa_panelPreview").fadeOut(),jQuery("#iaa_panelSettings").fadeIn(),jQuery("#iaa_avatarCustomPreview_mouth").css({left:"50%",top:iaa_settings.avatarMouthY+"px",marginLeft:0-jQuery("#iaa_avatarCustomPreview_mouth").width()/2})}function iaa_closeSettings(){jQuery("#iaa_panelPreview").fadeIn(),jQuery("#iaa_panelSettings").fadeOut()}function iaa_saveSettings(){var a=jQuery('#iaa_avatarPreviewContainer [data-type="corpse"]').attr("data-num"),e=jQuery('#iaa_avatarPreviewContainer [data-type="head"]').attr("data-num"),t=jQuery('#iaa_avatarPreviewContainer [data-type="hair"]').attr("data-num"),i=jQuery('#iaa_avatarPreviewContainer [data-type="eyes"]').attr("data-num"),n=jQuery('#iaa_avatarPreviewContainer [data-type="mouth"]').attr("data-num");jQuery("#iaa_loader").fadeIn(),jQuery.ajax({type:"post",url:ajaxurl,data:{action:"iaa_saveSettings",corpse_num:a,head_num:e,hair_num:t,eyes_num:i,mouth_num:n,position:jQuery("#iaa_settings_position").val(),initialText:jQuery("#iaa_settings_initialText").val(),hideOnClose:jQuery("#iaa_settings_hideOnClose").val(),enable:jQuery("#iaa_settings_enable").val(),colorBubble:jQuery("#iaa_settings_colorBubble").val(),colorText:jQuery("#iaa_settings_colorText").val(),colorButtons:jQuery("#iaa_settings_colorButtons").val(),colorButtonsText:jQuery("#iaa_settings_colorButtonsText").val(),colorShine:jQuery("#iaa_settings_colorShine").val(),avatarType:jQuery("#iaa_settings_avatarType").val(),avatarImg:jQuery("#iaa_settings_avatarImg").val(),avatarTalkImg:jQuery("#iaa_settings_avatarTalkImg").val(),avatarMouthY:parseInt(jQuery("#iaa_avatarCustomPreview_mouth").css("top")),avatarWidth:jQuery("#iaa_avatarCustomPreview").width(),avatarHeight:jQuery("#iaa_avatarCustomPreview").height(),avatarMouthWidth:jQuery("#iaa_avatarCustomPreview_mouth").width(),disableIntro:jQuery("#iaa_settings_disableIntro").val(),disableMobile:jQuery("#iaa_settings_disableMobile").val(),useWPML:jQuery("#iaa_settings_useWPML").val(),code:jQuery("#iaa_settings_purchaseCode").val()},success:function(){document.location.href=document.location.href}})}function iaa_avatarChangePart(a){var e=jQuery(this).parent().attr("data-part"),t=jQuery('#iaa_avatarPreviewContainer [data-type="'+e+'"]').attr("data-max"),i=jQuery('#iaa_avatarPreviewContainer [data-type="'+e+'"]').attr("data-num");jQuery(this).find("span").is(".glyphicon.glyphicon-chevron-left")?--i<1&&(i=t):t<++i&&(i=1),jQuery('#iaa_avatarPreviewContainer [data-type="'+e+'"]').attr("data-num",i)}function iaa_updateStepCanvas(){30<=++iaa_linkGradientIndex&&(iaa_linkGradientIndex=1);var a,e,u=jQuery("#iaa_stepsCanvas").get(0).getContext("2d");u.clearRect(0,0,jQuery("#iaa_stepsCanvas").attr("width"),jQuery("#iaa_stepsCanvas").attr("height")),jQuery.each(iaa_links,function(a){var e,t,i,n,r,o,s,l=this;l.destinationID&&0<jQuery("#"+l.originID).length&&0<jQuery("#"+l.destinationID).length?(e=parseInt(jQuery("#"+l.originID).css("left"))+jQuery("#"+l.originID).outerWidth()/2+22,t=parseInt(jQuery("#"+l.originID).css("top"))+jQuery("#"+l.originID).outerHeight()/2+22,i=parseInt(jQuery("#"+l.destinationID).css("left"))+jQuery("#"+l.destinationID).outerWidth()/2+22,s=parseInt(jQuery("#"+l.destinationID).css("top"))+jQuery("#"+l.destinationID).outerHeight()/2+22,n=u.createLinearGradient(e,t,i,s),l=.1+(r=o=iaa_linkGradientIndex/30),o=.2+o,u.lineWidth=4,1<l&&(l=0,o=.2),1<o&&(o=0),n.addColorStop(r,"#bdc3c7"),n.addColorStop(l,"#1ABC9C"),n.addColorStop(o,"#bdc3c7"),u.strokeStyle=n,u.beginPath(),u.moveTo(e,t),u.lineTo(i,s),u.stroke(),0==jQuery('.iaa_linkPoint[data-linkindex="'+a+'"]').length&&(s=jQuery('<a href="javascript:" data-linkindex="'+a+'" class="iaa_linkPoint"><span class="glyphicon glyphicon-pencil"></span></a>'),jQuery("#iaa_stepsContainer").append(s),s.click(function(){iaa_openWinLink(jQuery(this))})),iaa_repositionLinkPoint(a)):jQuery('.iaa_linkPoint[data-linkindex="'+a+'"]').remove()}),iaa_isLinking&&(a=(e=jQuery("#"+iaa_links[iaa_linkCurrentIndex].originID)).position().left+jQuery("#iaa_stepsOverflow").scrollLeft()+e.outerWidth()/2,e=e.position().top+jQuery("#iaa_stepsOverflow").scrollTop()+e.outerHeight()/2,u.strokeStyle="#bdc3c7",u.lineWidth=4,u.beginPath(),u.moveTo(a,e),u.lineTo(iaa_mouseX,iaa_mouseY),u.stroke())}function iaa_checkLicense(){var e=jQuery('#iaa_winActivation input[name="purchaseCode"]');e.val().length<9?e.parent().addClass("has-error"):(jQuery("#iaa_loader").delay(1400).fadeIn(100),jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_checkLicense",code:e.val()},success:function(a){jQuery("#iaa_loader").fadeOut(),"1"==a.length?e.parent().addClass("has-error"):(iaa_lock=!1,jQuery("#iaa_winActivation").modal("hide"))}}))}function iaa_openWinStep(a){1==iaa_settings.positionScreen?jQuery("#iaa_stepPreview #iaa_avatarPreviewContainer").addClass("iaa_right"):jQuery("#iaa_stepPreview #iaa_avatarPreviewContainer").removeClass("iaa_right"),a?jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_loadStep",stepID:a},success:function(a){(a=jQuery.parseJSON(a)).content=jQuery.parseJSON(a.content),a.content.id=a.id,iaa_currentStep=a.content,iaa_defaultStep=jQuery.extend(!0,{},iaa_currentStep),jQuery("#iaa_stepTitle").val(a.content.title),jQuery("#iaa_stepText").val(a.content.text.replace(/\r?<br \/>/g,"\n")),jQuery("#iaa_interactionsWrapper >*,#iaa_actionsWrapper >*").not(".iaa_stepIconPlus").remove(),iaa_currentStep.interactions&&jQuery.each(iaa_currentStep.interactions,function(){iaa_createInteraction(this)}),iaa_currentStep.actions&&jQuery.each(iaa_currentStep.actions,function(){iaa_createAction(this)}),jQuery("#iaa_btns").html(""),jQuery("#iaa_winStep").fadeIn(),jQuery("#iaa_stepsContainer").slideUp(),iaa_previewStep(),jQuery("#wpwrap").css({height:jQuery("#iaa_winStep").height()+48})}}):a=0,iaa_currentStep={id:a,text:"",actions:new Array,interactions:new Array}}function iaa_createAction(a){var e="",t=!0;switch(a.elementID&&(t=!1),a.type){case"showElement":e="glyphicon glyphicon-search";break;case"sendEmail":e="glyphicon glyphicon-envelope";break;case"changeUrl":e="glyphicon glyphicon-share-alt";break;case"executeJS":e="glyphicon glyphicon-flash";break;case"sendInteractions":e="glyphicon glyphicon-cloud-upload"}var i=jQuery('<div class="iaa_actionCircle" data-type="'+a.type+'"><span class="'+e+'"></span></div>');i.hide(),i.uniqueId(),t?(a.elementID=i.attr("id"),iaa_currentStep.actions.push(a)):i.attr("id",a.elementID),jQuery("#iaa_actionsWrapper .iaa_stepIconPlus").before(i),i.fadeIn(250),i.click(function(){iaa_openWinAction(jQuery(this))})}function iaa_createInteraction(a){var e="",t="",i=!0;switch(a.elementID&&(i=!1),a.type){case"textfield":t="T";break;case"numberfield":t="1";break;case"select":e="glyphicon glyphicon-th-list";break;case"button":e="glyphicon glyphicon-hand-up"}var n=jQuery('<div class="iaa_actionCircle" data-type="'+a.type+'"><span class="'+e+'">'+t+"</span></div>");n.hide(),n.uniqueId(),a.elementID=n.attr("id"),i&&iaa_currentStep.interactions.push(a),jQuery("#iaa_interactionsWrapper .iaa_stepIconPlus").before(n),n.fadeIn(250),n.click(function(){iaa_openWinInteraction(jQuery(this))})}function iaa_closeWin(a){a.fadeOut(),jQuery("#iaa_stepsContainer").slideDown()}function iaa_startLink(a){iaa_isLinking=!0,iaa_linkCurrentIndex=iaa_links.length,iaa_links.push({originID:a,destinationID:null})}function iaa_stopLink(a){var e=iaa_isLinking=!1;jQuery.each(iaa_links,function(){this.originID==iaa_links[iaa_linkCurrentIndex].originID&&this.destinationID==a.attr("id")&&(e=this)}),e?jQuery.grep(iaa_links,function(a){return a!=e}):(jQuery("#iaa_loader").fadeIn(),iaa_links[iaa_linkCurrentIndex].destinationID=a.attr("id"),jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_newLink",originStepID:jQuery("#"+iaa_links[iaa_linkCurrentIndex].originID).attr("data-stepid"),destinationStepID:jQuery("#"+iaa_links[iaa_linkCurrentIndex].destinationID).attr("data-stepid")},success:function(a){iaa_links[iaa_linkCurrentIndex].id=a,iaa_loadSteps()}}))}function iaa_itemsCheckRows(a){var e=jQuery(a).parent().children(".clearfix");e.detach(),jQuery(a).parent().append(e)}function iaa_openWinInteraction(e){jQuery("#iaa_interactionBubble ").find("input,select").parent().removeClass("has-error"),jQuery("#iaa_interactionBubble").addClass("iaa_hover"),setTimeout(function(){jQuery("#iaa_interactionBubble").removeClass("iaa_hover")},50),"block"==jQuery("#iaa_interactionBubble").css("display")&&jQuery("#iaa_interactionBubble").fadeOut(),jQuery("#iaa_interactionBubble").attr("data-item",e.attr("id")),jQuery("#iaa_interactionBubble").css({top:e.offset().top-jQuery("#iaa_bootstraped.iaa_bootstraped").offset().top+e.outerHeight()+12,left:e.offset().left-jQuery("#iaa_bootstraped.iaa_bootstraped").offset().left}),jQuery("#iaa_interactionBubble #iaa_interactionContent > [data-type]").hide(),e.attr("data-type")?(jQuery('#iaa_interactionBubble #iaa_interactionContent > [data-type="select"] .form-group:not(.default)').remove(),jQuery("#iaa_interactionBubble").attr("data-type",e.attr("data-type")),jQuery("#iaa_interactionBubble").data("type",e.attr("data-type")),jQuery('#iaa_interactionBubble #iaa_interactionContent > [data-type="'+e.attr("data-type")+'"]').slideDown(),jQuery("#iaa_interactionSelect").select2("val",e.attr("data-type")),jQuery('#iaa_interactionBubble input[name="itemID"]').val(iaa_currentStep.interactions[e.index()].itemID),jQuery.each(iaa_currentStep.interactions[e.index()],function(a){jQuery('#iaa_interactionBubble #iaa_interactionContent > [data-type="'+e.attr("data-type")+'"]').find('[name="'+a+'"]').val(this),"numberfield"==e.attr("data-type")&&"validation"==a&&("fill"==this?jQuery("#iaa_interactionValidationSelectNum").val("fill"):jQuery("#iaa_interactionValidationSelectNum").val("")),"textfield"==e.attr("data-type")&&"validation"==a&&("fill"==this?jQuery("#iaa_interactionValidationSelect").val("fill"):"email"==this?jQuery("#iaa_interactionValidationSelect").val("email"):jQuery("#iaa_interactionValidationSelect").val("")),"select"==e.attr("data-type")&&"s_"==a.substr(0,2)&&iaa_interactionAddSelect("select").find("input").val(this)})):(jQuery("#iaa_interactionBubble").removeAttr("data-item"),jQuery("#iaa_interactionBubble").attr("data-type","null"),jQuery("#iaa_interactionSelect").select2("val",""),jQuery("#iaa_interactionBubble ").find("input,select").val(""),jQuery("#iaa_interactionBubble ").find('input[name="itemID"]').val(iaa_getUniqueTime())),jQuery("#iaa_interactionBubble").fadeIn(250),setTimeout(function(){jQuery("#wpwrap").css({height:jQuery("#iaa_bootstraped").height()+48})},300)}function iaa_getUniqueTime(){for(var a=(new Date).getTime();a==(new Date).getTime(););return(new Date).getTime()}function iaa_changeInteractionBubble(a){jQuery("#iaa_interactionBubble").data("type",a),jQuery("#iaa_interactionBubble #iaa_interactionContent > div").slideUp(),""!=a&&jQuery('#iaa_interactionBubble #iaa_interactionContent > [data-type="'+a+'"]').slideDown(),"select"==a&&(0!=jQuery('#iaa_interactionContent > [data-type="'+a+'"]').find(".form-group:not(.default)").length&&""!=jQuery('#iaa_interactionContent > [data-type="'+a+'"]').find(".form-group:not(.default):last-child").find("input").val()||iaa_interactionAddSelect(a))}function iaa_interactionAddSelect(a){var e=jQuery('#iaa_interactionContent > [data-type="'+a+'"]').find(".form-group").length,e=jQuery('<div class="form-group"><label>'+iaa_data.txt_option+'</label><input type="text" placeholder="'+iaa_data.txt_option+'" class="form-control" name="s_'+e+'_value"></div>');return e.find("input").keyup(function(){""==jQuery(this).val()?0<jQuery(this).closest(".form-group:not(.default)").index()&&jQuery(this).closest(".form-group:not(.default)").remove():0==jQuery(this).closest(".form-group:not(.default)").next(".form-group:not(.default)").length&&iaa_interactionAddSelect(a)}),jQuery('#iaa_interactionContent > [data-type="'+a+'"]').append(e),e}function iaa_openWinLink(a){iaa_currentLinkIndex=a.attr("data-linkindex"),jQuery("#iaa_winLink").attr("data-linkindex",a.attr("data-linkindex")),jQuery(".iaa_conditionItem").remove();var e=iaa_getStepByID(jQuery("#"+iaa_links[a.attr("data-linkindex")].originID).attr("data-stepid")),a=iaa_getStepByID(jQuery("#"+iaa_links[a.attr("data-linkindex")].destinationID).attr("data-stepid"));jQuery("#iaa_linkInteractions").show(),iaa_currentStep=e,jQuery("#iaa_linkOriginTitle").html(e.content.title),jQuery("#iaa_linkDestinationTitle").html(a.content.title),jQuery.each(iaa_links[iaa_currentLinkIndex].conditions,function(){iaa_addLinkInteraction(this)}),jQuery("#iaa_winLink").fadeIn(250),setTimeout(function(){jQuery("#wpwrap").css({height:jQuery("#iaa_bootstraped").height()+48})},300)}function iaa_addLinkInteraction(a){var e=jQuery('<div class="iaa_conditionItem"></div>'),i=jQuery('<select class="iaa_conditionSelect form-control"></select>');i.append('<option value="_date" data-type="date">'+iaa_data.txt_currentDate+"</option>"),i.append('<option value="_page" data-type="page">'+iaa_data.txt_currentPage+"</option>"),jQuery.each(iaa_steps,function(){var t=this;jQuery.each(this.content.interactions,function(){var a=t.id+"_"+this.itemID,e=jQuery('#iaa_interactionSelect option[value="'+this.type+'"]').html();i.append('<option value="'+a+'" data-type="'+this.type+'">'+t.content.title+" : "+e+' " '+this.label+' "</option>')})});var t=jQuery('<select class="iaa_conditionoperatorSelect form-control"></select>');i.change(function(){var a=jQuery(this).parent().parent().find(".iaa_conditionoperatorSelect");a.find("option").remove();var e=iaa_conditionGetOperators(i.find("option").filter(":selected").attr("data-type"),i);jQuery.each(e,function(){a.append('<option value="'+this.value+'">'+this.text+"</option>")}),t.change()}),a&&i.val(a.interaction),i.change();var n=iaa_conditionGetOperators(i.find("option").filter(":selected").attr("data-type"),i);jQuery.each(n,function(){t.append('<option value="'+this.value+'">'+this.text+"</option>")}),t.change(function(){iaa_linksUpdateFields(jQuery(this))});n=jQuery('<div class="col-md-4"></div>');n.append(i),e.append(n);jQuery('<div class="row"></div>');n=jQuery('<div class="col-md-4"></div>');n.append(t),e.append(n),e.append('<div class="col-md-1"><a href="javascript:" class="iaa_conditionDelBtn" ><span class="glyphicon glyphicon-remove"></span></a> </div>'),e.find(".iaa_conditionDelBtn").on("click",function(){iaa_conditionRemove(this)}),a&&(t.val(a.action),t.change(),a.value&&t.parent().parent().find(".iaa_conditionValue").val(a.value)),setTimeout(function(){iaa_linksUpdateFields(t,a),a.value&&t.parent().parent().find(".iaa_conditionValue").val(a.value)},500),jQuery("#iaa_linkInteractions").append(e)}function iaa_linksUpdateFields(a,e){a.parent().parent().find(".iaa_conditionValue").parent().remove(),"page"==a.parent().parent().find(".iaa_conditionSelect option:selected").attr("data-type")&&0==a.parent().parent().find(".iaa_conditionValue").length&&a.parent().parent().find(".col-md-1").before('<div class="col-md-3"><input type="text" placeholder="http://..." class="iaa_conditionValue form-control" /> </div>'),"numberfield"!=a.parent().parent().find(".iaa_conditionSelect option:selected").attr("data-type")||"inferior"!=a.val()&&"superior"!=a.val()&&"equal"!=a.val()||0==a.parent().parent().find(".iaa_conditionValue").length&&a.parent().parent().find(".col-md-1").before('<div class="col-md-3"><input type="number" step="any" class="iaa_conditionValue form-control" /> </div>'),"date"!=a.parent().parent().find(".iaa_conditionSelect option:selected").attr("data-type")&&"datefield"!=a.parent().parent().find(".iaa_conditionSelect option:selected").attr("data-type")||"inferior"!=a.val()&&"superior"!=a.val()&&"equal"!=a.val()||(0==a.parent().parent().find(".iaa_conditionValue").length&&(a.parent().parent().find(".col-md-1").before('<div class="col-md-3"><input type="text" step="any" class="iaa_conditionValue form-control"/> </div>'),a.parent().parent().find(".iaa_conditionValue").datepicker({dateFormat:"yy-mm-dd"})),e&&e.value&&a.parent().parent().find(".iaa_conditionValue").val(e.value))}function iaa_conditionRemove(a){jQuery(a).closest(".iaa_conditionItem").remove()}function iaa_linkSave(){var a;iaa_canSaveLink&&(iaa_canSaveLink=!1,setTimeout(function(){iaa_canSaveLink=!0},1500),iaa_links[iaa_currentLinkIndex].conditions=new Array,jQuery(".iaa_conditionItem").each(function(){iaa_links[iaa_currentLinkIndex].conditions.push({interaction:jQuery(this).find(".iaa_conditionSelect").val(),action:jQuery(this).find(".iaa_conditionoperatorSelect").val(),value:jQuery(this).find(".iaa_conditionValue").val()})}),a=iaa_links.slice(),jQuery.each(a,function(){this.originID=jQuery("#"+this.originID).attr("data-stepid"),this.destinationID=jQuery("#"+this.destinationID).attr("data-stepid")}),jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_saveLinks",links:JSON.stringify(a)},success:function(){iaa_closeWin(jQuery("#iaa_winLink")),iaa_loadSteps()}}))}function iaa_linkDel(){iaa_links.splice(jQuery.inArray(iaa_links[iaa_currentLinkIndex],iaa_links),1);var a=iaa_links.slice();jQuery.each(a,function(){this.originID=jQuery("#"+this.originID).attr("data-stepid"),this.destinationID=jQuery("#"+this.destinationID).attr("data-stepid")}),jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_saveLinks",links:JSON.stringify(a)},success:function(){iaa_closeWin(jQuery("#iaa_winLink")),iaa_loadSteps()}})}function iaa_conditionGetOperators(a,e){var t=new Array;switch(a){case"button":t.push({value:"clicked",text:iaa_data.txt_clicked});break;case"numberfield":t.push({value:"filled",text:iaa_data.txt_filled}),t.push({value:"superior",text:iaa_data.txt_superiorTo}),t.push({value:"inferior",text:iaa_data.txt_inferiorTo}),t.push({value:"equal",text:iaa_data.txt_equalTo});break;case"textfield":t.push({value:"filled",text:iaa_data.txt_filled});break;case"page":t.push({value:"equal",text:iaa_data.txt_equalTo});break;case"datefield":t.push({value:"filled",text:iaa_data.txt_filled}),t.push({value:"superior",text:iaa_data.txt_superiorTo}),t.push({value:"inferior",text:iaa_data.txt_inferiorTo}),t.push({value:"equal",text:iaa_data.txt_equalTo});break;case"date":t.push({value:"superior",text:iaa_data.txt_superiorTo}),t.push({value:"inferior",text:iaa_data.txt_inferiorTo}),t.push({value:"equal",text:iaa_data.txt_equalTo});break;case"select":var i=e.val().substr(0,e.val().indexOf("_")),n=e.val().substr(e.val().indexOf("_")+1,e.val().length),i=iaa_getStepByID(i),r=!1;i&&(jQuery.each(i.content.interactions,function(){this.itemID==n&&(r=this)}),jQuery.each(r,function(a){"s_"==a.substr(0,a.indexOf("_")+1)&&""!=this&&t.push({value:"v_"+this,text:this})}))}return t}function iaa_openWinAction($item){jQuery("#iaa_actionBubble").addClass("iaa_hover"),setTimeout(function(){jQuery("#iaa_actionBubble").removeClass("iaa_hover")},50);var action=!1;jQuery.each(iaa_currentStep.actions,function(){this.elementID==$item.attr("id")&&(action=this)}),jQuery("#iaa_actionBubble").attr("data-item",$item.attr("id")),jQuery("#iaa_actionBubble").css({top:$item.offset().top-jQuery("#iaa_bootstraped.iaa_bootstraped").offset().top+$item.outerHeight()+12,left:$item.offset().left-jQuery("#iaa_bootstraped.iaa_bootstraped").offset().left}),jQuery("#iaa_actionBubble #iaa_actionContent > [data-type]").hide(),$item.attr("data-type")?(jQuery("#iaa_actionBubble").data("type",$item.attr("data-type")),jQuery("#iaa_actionSelect").select2("val",$item.attr("data-type")),jQuery('#iaa_actionBubble #iaa_actionContent > [data-type="'+$item.attr("data-type")+'"]').find("input,select,textarea").each(function(){eval("jQuery(this).val(action."+jQuery(this).attr("name")+".replace(/\\[g\\]/g,'\"'));"),eval("jQuery(this).val(action."+jQuery(this).attr("name")+".replace(/\\|g\\|/g,'\"'));")}),jQuery('#iaa_actionBubble #iaa_actionContent > [data-type="'+$item.attr("data-type")+'"]').slideDown()):(jQuery("#iaa_actionSelect").select2("val",""),jQuery("#iaa_actionBubble").removeAttr("data-item")),jQuery("#iaa_actionElementSelected").hide(),jQuery("#iaa_actionBubble").fadeIn()}function iaa_changeActionBubble(a){jQuery("#iaa_actionBubble").data("type",a),jQuery("#iaa_actionBubble #iaa_actionContent > div").slideUp(),""!=a&&jQuery('#iaa_actionBubble #iaa_actionContent > [data-type="'+a+'"]').slideDown()}function iaa_updateWinItemPosition(){var a;"none"!=jQuery("#iaa_winStep").css("display")&&0<(a=jQuery("#"+jQuery("#iaa_itemWindow").attr("data-item"))).length?jQuery("#iaa_itemWindow").css({top:a.offset().top-jQuery("#iaa_bootstraped.iaa_bootstraped").offset().top+a.outerHeight()+12,left:a.offset().left-jQuery("#iaa_bootstraped.iaa_bootstraped").offset().left}):jQuery("#iaa_itemWindow").fadeOut()}function iaa_checkEmail(a){return"-1"!=a.indexOf("@")&&"-1"!=a.indexOf(".")&&""!=a}function iaa_actionSave(){var title=iaa_data.txt_redirection,chkCreate=!0,options={},type;jQuery("#iaa_actionBubble").data("type")?(type=jQuery("#iaa_actionBubble").data("type"),"showElement"==jQuery("#iaa_actionBubble").data("type")?(title=iaa_data.txt_showElement,""==jQuery('#iaa_actionBubble [data-type="showElement"]  [name="element"]').val()&&(chkCreate=!1,jQuery('#iaa_actionBubble [data-type="showElement"] a').addClass("btn-danger"))):"sendEmail"==jQuery("#iaa_actionBubble").data("type")?(title=iaa_data.txt_sendEmail,iaa_checkEmail(jQuery('#iaa_actionBubble [data-type="sendEmail"]  [name="email"]').val())||(chkCreate=!1,jQuery('#iaa_actionBubble  [data-type="sendEmail"] [name="email"]').parent().addClass("has-error"))):"changeUrl"==jQuery("#iaa_actionBubble").data("type")?jQuery('#iaa_actionBubble [data-type="changeUrl"] [name="url"]').val().indexOf("http")<0&&(chkCreate=!1,jQuery('#iaa_actionBubble  [data-type="changeUrl"] [name="url"]').parent().addClass("has-error")):"executeJS"==jQuery("#iaa_actionBubble").data("type")&&jQuery('#iaa_actionBubble [data-type="executeJS"] [name="executeJS"]').val().length<3&&(chkCreate=!1,jQuery('#iaa_actionBubble  [data-type="executeJS"] [name="executeJS"]').parent().addClass("has-error")),chkCreate&&(jQuery('#iaa_actionBubble [data-type="'+type+'"] select,#iaa_actionBubble [data-type="'+type+'"] input, #iaa_actionBubble [data-type="'+type+'"] textarea').each(function(){var value=jQuery(this).val().replace(/\"/g,"|g|");eval("options."+jQuery(this).attr("name")+"= value;"),options.type=type}),options.elementID=jQuery("#iaa_actionBubble").attr("data-item"),void 0!==jQuery("#iaa_actionBubble").attr("data-item")&&""!=jQuery("#iaa_actionBubble").attr("data-item")?iaa_currentStep.actions[jQuery("#"+jQuery("#iaa_actionBubble").attr("data-item")).index()]=options:iaa_createAction(options),jQuery("#iaa_actionBubble #iaa_actionContent > div").slideUp(),jQuery("#iaa_actionBubble").fadeOut(),iaa_previewStep())):(chkCreate=!1,jQuery("#iaa_interactionBubble #iaa_actionSelect").val(""),jQuery("#iaa_actionBubble #iaa_actionContent > div").slideUp(),jQuery("#iaa_actionBubble").fadeOut())}function iaa_interactionDel(){jQuery("#iaa_interactionBubble").fadeOut();var a,e=jQuery("#iaa_interactionBubble").attr("data-item");e&&""!=e&&(a=jQuery("#"+e).index(),iaa_currentStep.interactions=jQuery.grep(iaa_currentStep.interactions,function(a){if(a.elementID!=e)return a}),jQuery("#iaa_interactionsWrapper .iaa_actionCircle").eq(a).remove(),$("#"+e).remove()),iaa_previewStep()}function iaa_existInDefaultStep(a){var e=!1;return jQuery.each(iaa_defaultStep.interactions,function(){this.itemID==a&&(e=!0)}),e}function iaa_actionDel(){jQuery("#iaa_actionBubble").fadeOut();var a,e=jQuery("#iaa_actionBubble").attr("data-item");e&&""!=e&&(a=jQuery("#"+e).index(),iaa_currentStep.actions=jQuery.grep(iaa_currentStep.actions,function(a){if(a.elementID!=e)return a}),jQuery("#iaa_actionsWrapper .iaa_actionCircle").eq(a).remove(),$("#"+e).remove())}function iaa_interactionSave(){var spanClass="",spanContent="",title=iaa_data.txt_redirection,chkCreate=!0,type="",options={},values,type;jQuery("#iaa_interactionBubble").data("type")?(type=jQuery("#iaa_interactionBubble").data("type"),"textfield"==jQuery("#iaa_interactionBubble").data("type")&&(spanContent="T",title=iaa_data.txt_textfield,""==jQuery('#iaa_interactionBubble [data-type="textfield"] [name="label"]').val()&&(chkCreate=!1,jQuery('#iaa_interactionBubble [data-type="textfield"] [name="label"]').parent().addClass("has-error"))),"numberfield"==jQuery("#iaa_interactionBubble").data("type")&&(spanContent="1",title=iaa_data.txt_numberfield),"select"==jQuery("#iaa_interactionBubble").data("type")&&(spanClass="glyphicon glyphicon-th-list",title=iaa_data.txt_select,values=new Array,jQuery('#iaa_interactionBubble [data-type="select"] .form-group input').each(function(){""!=jQuery(this).val()&&values.push(jQuery(this).val())})),"button"==jQuery("#iaa_interactionBubble").data("type")&&(spanClass="glyphicon glyphicon-hand-up",""==jQuery('#iaa_interactionBubble [data-type="button"] [name="label"]').val()&&(chkCreate=!1,jQuery('#iaa_interactionBubble [data-type="button"] [name="label"]').parent().addClass("has-error"))),jQuery('#iaa_interactionBubble [name="itemID"]').val().length<3&&(chkCreate=!1,jQuery('#iaa_interactionBubble [name="itemID"]').parent().addClass("has-error")),chkCreate&&(jQuery('#iaa_interactionBubble [data-type="'+type+'"] select,#iaa_interactionBubble [data-type="'+type+'"] input, #iaa_interactionBubble [data-type="'+type+'"] textarea').each(function(){eval("options."+jQuery(this).attr("name")+"= jQuery(this).val();"),options.type=type}),options.itemID=jQuery('#iaa_interactionBubble [name="itemID"]').val(),jQuery("#iaa_interactionBubble").attr("data-item")&&""!=jQuery("#iaa_interactionBubble").attr("data-item")?iaa_currentStep.interactions[jQuery("#"+jQuery("#iaa_interactionBubble").attr("data-item")).index()]=options:(iaa_createInteraction(options),jQuery("#iaa_stepPreview #iaa_avatarPreviewContainer #iaa_talkBubble").height(parseInt(jQuery("#iaa_stepPreview #iaa_avatarPreviewContainer #iaa_talkBubble").height())+48)),jQuery("#iaa_interactionBubble #iaa_interactionContent > div").slideUp(),jQuery("#iaa_interactionBubble").fadeOut(),iaa_previewStep())):(chkCreate=!1,jQuery("#iaa_interactionBubble #iaa_interactionSelect").val(""),jQuery("#iaa_interactionBubble #iaa_interactionContent > div").slideUp(),jQuery("#iaa_interactionBubble").fadeOut())}function iaa_startSelectElement(){0<jQuery("#iaa_websiteFrame").length&&(jQuery("#iaa_websiteFrame").remove(),jQuery(".iaa_selectElementPanel").remove()),jQuery("body").append('<iframe id="iaa_websiteFrame" src="'+iaa_data.websiteUrl+'"></iframe>'),jQuery("#iaa_websiteFrame").on("load",iaa_websiteFrameLoaded),jQuery("#iaa_websiteFrame").hover(function(){jQuery("#iaa_websiteFrame").addClass("iaa_hover")},function(){jQuery("#iaa_websiteFrame").removeClass("iaa_hover")}),jQuery("body").append('<div id="iaa_bootstraped" class="iaa_bootstraped iaa_selectElementPanel"></div>'),jQuery(".iaa_selectElementPanel").hover(function(){jQuery(".iaa_selectElementPanel").addClass("iaa_hover")},function(){jQuery(".iaa_selectElementPanel").removeClass("iaa_hover")}),jQuery(".iaa_selectElementPanel").html("<p>"+iaa_data.txt_selectStart+"</p>"),jQuery(".iaa_selectElementPanel").append('<p><a href="javascript:" class="btn btn-primary" data-action="iaa_selectionSelectElement" >'+iaa_data.txt_selectBtn+'</a>&nbsp;&nbsp;<a href="javascript:" class="btn btn-danger" data-action="iaa_stopSelectElement">'+iaa_data.txt_cancel+"</a></p>"),jQuery(".iaa_selectElementPanel").find('[data-action="iaa_stopSelectElement"]').on("click",iaa_stopSelectElement),jQuery(".iaa_selectElementPanel").find('[data-action="iaa_selectionSelectElement"]').on("click",iaa_selectionSelectElement),jQuery("#iaa_loader").fadeIn(),jQuery(".iaa_selectElementPanel").delay(500).fadeIn()}function iaa_selectionSelectElement(){jQuery(".iaa_selectElementPanel").html("<p>"+iaa_data.txt_selectSelection+"</p>"),jQuery(".iaa_selectElementPanel").append('<p><a href="javascript:" class="btn btn-danger"  data-action="iaa_stopSelectElement">'+iaa_data.txt_cancel+"</a></p>"),jQuery(".iaa_selectElementPanel").find('[data-action="iaa_stopSelectElement"]').on("click",iaa_stopSelectElement),$("#iaa_websiteFrame")[0].contentWindow.jQuery("body").trigger("iaa_startSelection")}function iaa_confirmSelectElement(a){iaa_currentDomElement=a,jQuery(".iaa_selectElementPanel").html("<p>"+iaa_data.txt_selectConfirm+"</p>"),jQuery(".iaa_selectElementPanel").append('<p><a href="javascript:" class="btn btn-primary" data-action="iaa_confirmedSelectElement" >'+iaa_data.txt_yes+'</a>&nbsp;&nbsp;<a href="javascript:" data-action="iaa_startSelectElement" class="btn btn-danger">'+iaa_data.txt_no+"</a></p>"),jQuery(".iaa_selectElementPanel").find('[data-action="iaa_confirmedSelectElement"]').on("click",iaa_confirmedSelectElement),jQuery(".iaa_selectElementPanel").find('[data-action="iaa_startSelectElement"]').on("click",iaa_startSelectElement)}function iaa_websiteFrameLoaded(){jQuery("#iaa_loader").fadeOut()}function iaa_stopSelectElement(){jQuery("#iaa_websiteFrame").fadeOut(250),jQuery(".iaa_selectElementPanel").fadeOut(250),setTimeout(function(){jQuery("#iaa_websiteFrame").remove(),jQuery(".iaa_selectElementPanel").remove()},300)}function iaa_confirmedSelectElement(){var a=iaa_getPath(iaa_currentDomElement);jQuery('#iaa_actionContent input[name="element"]').val(a),jQuery('#iaa_actionContent input[name="url"]').val(jQuery("#iaa_websiteFrame").contents().get(0).location.href),iaa_stopSelectElement(),jQuery("#iaa_actionElementSelected").fadeIn(),jQuery("#iaa_actionBubble").fadeIn()}function iaa_getPath(a){var e="";return 0<jQuery(a).length&&void 0!==jQuery(a).prop("tagName")&&(jQuery(a).attr("id")&&"ultimate"!=jQuery(a).attr("id").substr(0,8)?e+="#"+jQuery(a).attr("id"):(e=">"+jQuery(a).prop("tagName")+":nth-child("+(jQuery(a).index()+1)+")"+e,e=iaa_getPath(jQuery(a).parent())+e)),e}function iaa_saveStep(){var a;iaa_currentStep.bubbleWidth=jQuery("#iaa_stepPreview #iaa_talkBubble").innerWidth(),iaa_currentStep.bubbleHeight=jQuery("#iaa_stepPreview #iaa_talkBubble").innerHeight(),iaa_previewStep(),jQuery("#iaa_stepTitle").parent().removeClass("has-error"),iaa_currentStep.title=jQuery("#iaa_stepTitle").val(),iaa_currentStep.text=jQuery("#iaa_stepText").val(),iaa_currentStep.title=iaa_currentStep.title.replace(/\"/g,"'"),iaa_currentStep.text=iaa_currentStep.text.replace(/\"/g,"'"),iaa_currentStep.text=iaa_currentStep.text.replace(/\r?\n/g,"<br />"),""==jQuery("#iaa_stepTitle").val()?jQuery("#iaa_stepTitle").parent().addClass("has-error"):(a=new Array,jQuery.each(iaa_defaultStep.interactions,function(){0==jQuery("#"+this.elementID).length&&a.push(this.elementID)}),jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_saveStep",step:JSON.stringify(iaa_currentStep),removedInter:a},success:function(a){iaa_currentStep.id=a,iaa_closeWin(jQuery("#iaa_winStep")),iaa_loadSteps()}}))}function iaa_removeAllSteps(){jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_removeAllSteps"},success:function(){iaa_loadSteps()}})}function iaa_previewStep(){0<jQuery("#iaa_stepPreview #iaa_talkBubble").length&&jQuery("#iaa_stepPreview #iaa_talkBubble").remove();var a=jQuery("#iaa_stepText").val();a=(a=(a=a.replace(/\[b\]/g,"<strong>").replace(/\[\/b\]/g,"</strong>")).replace(/\[u\]/g,"<u>").replace(/\[\/u\]/g,"</u>")).replace(/\r?\n/g,"<br />");var e=jQuery('<div id="iaa_talkBubble"><div id="iaa_bubbleContent"></div></div>');e.find("#iaa_bubbleContent").append('<div class="iaa_talkText"><p>'+a+"</p></div>"),e.resizable({maxHeight:260,maxWidth:680,minHeight:32,minHeight:32,minWidth:180,stop:function(){iaa_currentStep.bubbleWidth=jQuery("#iaa_stepPreview #iaa_talkBubble").innerWidth(),iaa_currentStep.bubbleHeight=jQuery("#iaa_stepPreview #iaa_talkBubble").innerHeight(),setTimeout(function(){jQuery("#wpwrap").css({height:jQuery("#iaa_winStep").height()+48})},250)}}),iaa_currentStep.bubbleWidth&&e.css({width:iaa_currentStep.bubbleWidth+"px",height:iaa_currentStep.bubbleHeight+"px"});var n="",r="",t=new Array;jQuery.each(iaa_currentStep.interactions,function(a){jQuery.inArray(this,t)<0?t.push(this):iaa_currentStep.interactions.splice(jQuery.inArray(iaa_currentStep.interactions[a],iaa_currentStep.interactions),1)}),jQuery.each(iaa_currentStep.interactions,function(){var a=this;a.elementID;switch(a.type){case"button":r+='<a href="javascript:" class="iaa_btn">'+a.label+"</a>";break;case"textfield":n+='<div class="iaa_field"><label>'+a.label+'</label><input type="text" data-valisation="'+a.validation+'" /></div>';break;case"numberfield":var e="";1==a.decimals&&(e='step="any"'),n+='<div class="iaa_field" data-type="numberfield" data-id="'+a.itemID+'" data-validation="'+a.validation+'"><label>'+a.label+'</label><input type="number" '+e+' value="'+a.min+'" min="'+a.min+'" max="'+a.max+'"  /></div>';break;case"select":var t=new Array,i="<select>";jQuery.each(a,function(a){"s_"==a.substr(0,2)&&""!=this&&(t.push(this),i+='<option value="'+this+'">'+this+"</option>")}),i+="</select>",n+='<div class="iaa_field" data-type="select" data-id="'+a.itemID+'"><label>'+a.label+"</label>"+i+"</div>"}}),n+='<p class="iaa_btns">'+r+"</p>",e.find("#iaa_bubbleContent").append('<div class="iaa_talkInteraction">'+n+"</div>"),jQuery("#iaa_stepPreview #iaa_avatarPreviewContainer").append(e),e.css({bottom:parseInt(e.closest(".iaa_avatarContainer").css("height"))+13}),jQuery("#iaa_stepPreview").animate({height:e.height()+parseInt(e.css("bottom"))+40},350),e.fadeIn()}iaa_data=iaa_data[0],jQuery(document).ready(function(){jQuery("body").append('<div id="iaa_loader"><div class="iaa_spinner"><div class="double-bounce1"></div><div class="double-bounce2"></div></div></div>'),jQuery("#iaa_loader").fadeIn(),jQuery("#iaa_stepsContainer").droppable({drop:function(a,e){e=jQuery(e.draggable[0]);jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_saveStepPosition",stepID:e.attr("data-stepid"),posX:parseInt(e.css("left")),posY:parseInt(e.css("top"))}})}}),jQuery(".imageBtn").click(function(){return iaa_formfield=jQuery(this).prev("input"),tb_show("","media-upload.php?TB_iframe=true"),!1}),window.old_tb_remove=window.tb_remove,window.tb_remove=function(){window.old_tb_remove(),iaa_formfield=null},window.original_send_to_editor=window.send_to_editor,window.send_to_editor=function(a){iaa_formfield?(fileurl=jQuery("img",a).attr("src"),jQuery(iaa_formfield).val(fileurl),"iaa_settings_avatarImg"==jQuery(iaa_formfield).attr("id")&&iaa_autoSaveSettings(),"iaa_settings_avatarTalkImg"==jQuery(iaa_formfield).attr("id")&&iaa_autoSaveSettings(),tb_remove()):window.original_send_to_editor(a)},jQuery("#iaa_avatarCustomPreview #iaa_avatarCustomPreview_mouth").draggable({containment:"#iaa_avatarCustomPreviewContent",axis:"y"}),jQuery(".colorpick").each(function(){var a=jQuery(this);0==jQuery(this).prev(".iaa_colorPreview").length&&jQuery(this).before('<div class="iaa_colorPreview" style="background-color:#'+a.val().substr(1,7)+'"></div>'),jQuery(this).prev(".iaa_colorPreview").click(function(){jQuery(this).next(".colorpick").trigger("click")}),jQuery(this).colpick({color:a.val().substr(1,7),onChange:function(a,e,t,i,n){jQuery(i).val("#"+e),jQuery(i).prev(".iaa_colorPreview").css({backgroundColor:"#"+e})}})}),jQuery("#iaa_winActivation").is('[data-show="true"]')&&-1<document.location.href.indexOf("admin.php?page=iaa_")?(jQuery("#iaa_winActivation").modal("show"),jQuery("#iaa_winActivation .modal-dialog").hover(function(){jQuery(this).addClass("iaa_hover")},function(){jQuery(this).removeClass("iaa_hover")}),iaa_lock=!0,jQuery("#iaa_closeWinActivationBtn").click(function(){iaa_lock||jQuery("#iaa_winActivation").modal("hide")}),jQuery("#iaa_closeWinActivationBtn .iaa_text").data("num",10).html("Wait 10 seconds"),iaa_actTimer=setInterval(function(){var a=jQuery("#iaa_closeWinActivationBtn .iaa_text").data("num");0<--a?jQuery("#iaa_closeWinActivationBtn .iaa_text").data("num",a).html("Wait "+a+" seconds"):(jQuery("#iaa_closeWinActivationBtn").removeClass("disabled"),iaa_lock=!1,jQuery("#iaa_closeWinActivationBtn .iaa_text").data("num","").html("Close"))},1e3)):jQuery("#iaa_winActivation").attr("data-show","false"),jQuery("#iaa_winActivation").on("hide.bs.modal",function(a){iaa_lock&&!jQuery("#iaa_winActivation .modal-dialog").is(".iaa_hover")&&a.preventDefault()}),jQuery("#wpwrap").css({height:jQuery("#iaa_bootstraped").height()+48}),setInterval(function(){"block"==jQuery("#iaa_winStep").css("display")?jQuery("#wpwrap").css({height:jQuery("#iaa_winStep").height()+48}):jQuery("#wpwrap").css({height:jQuery("#iaa_bootstraped").height()+48})},1e3),jQuery("#iaa_settings_avatarType").change(function(){"0"==jQuery("#iaa_settings_avatarType").val()?(jQuery("#iaa_avatarDefault").show(),jQuery("#iaa_avatarCustom").hide()):(jQuery("#iaa_avatarDefault").hide(),jQuery("#iaa_avatarCustom").show()),iaa_settings_updatePreviewCustomAvatar()}),iaa_canvasTimer=setInterval(iaa_updateStepCanvas,30),jQuery(document).mousemove(function(a){iaa_isLinking&&(iaa_mouseX=a.pageX-jQuery("#iaa_stepsContainer").offset().left,iaa_mouseY=a.pageY-jQuery("#iaa_stepsContainer").offset().top)}),jQuery(window).resize(iaa_updateStepsDesign),0<jQuery('#iaa_bootstraped.iaa_bootstraped  [data-toggle="select"]').length&&jQuery('#iaa_bootstraped.iaa_bootstraped  [data-toggle="select"]').select2(),iaa_itemWinTimer=setInterval(iaa_updateWinItemPosition,30),jQuery("#iaa_actionSelect").change(function(){iaa_changeActionBubble(jQuery("#iaa_actionSelect").val())}),jQuery("#iaa_interactionSelect").change(function(){iaa_changeInteractionBubble(jQuery("#iaa_interactionSelect").val())}),jQuery("#iaa_interactionBubble,#iaa_actionBubble,#iaa_linkBubble").hover(function(){jQuery(this).addClass("iaa_hover")},function(){jQuery(this).removeClass("iaa_hover")}),jQuery("body").click(function(){jQuery("#iaa_interactionBubble").is(".iaa_hover")||jQuery("#iaa_interactionBubble").fadeOut(),jQuery("#iaa_actionBubble").is(".iaa_hover")||jQuery("#iaa_websiteFrame").is(".iaa_hover")||jQuery(".iaa_selectElementPanel").is(".iaa_hover")||jQuery("#iaa_actionBubble").fadeOut(),jQuery("#iaa_linkBubble").is(".iaa_hover")||jQuery("#iaa_linkBubble").fadeOut()}),$("body").on("iaa_confirmSelectElement",function(a,e){iaa_confirmSelectElement(e)}),jQuery(document).mousedown(function(a){2==a.button&&iaa_isLinking&&(iaa_isLinking=!1)}),jQuery(".iaa_avatarSettingsField a").click(iaa_avatarChangePart),jQuery("#iaa_stepText,#iaa_stepTitle").keyup(iaa_previewStep),iaa_loadSteps(),iaa_loadSettings(),$('[data-action="iaa_closeSettings"]').on("click",iaa_closeSettings),$('[data-action="iaa_openSettings"]').on("click",iaa_openSettings),$('[data-action="iaa_saveSettings"]').on("click",iaa_saveSettings),$('[data-action="iaa_saveStep"]').on("click",iaa_saveStep),$('[data-action="iaa_addLinkInteraction"]').on("click",iaa_addLinkInteraction),$('[data-action="iaa_linkDel"]').on("click",iaa_linkDel),$('[data-action="iaa_interactionSave"]').on("click",iaa_interactionSave),$('[data-action="iaa_interactionDel"]').on("click",iaa_interactionDel),$('[data-action="iaa_startSelectElement"]').on("click",iaa_startSelectElement),$('[data-action="iaa_actionSave"]').on("click",iaa_actionSave),$('[data-action="iaa_actionDel"]').on("click",iaa_actionDel),$('[data-action="iaa_checkLicense"]').on("click",iaa_checkLicense),$('[data-action="iaa_removeAllSteps"]').on("click",iaa_removeAllSteps),$('[data-action="iaa_checkLicense"]').on("click",iaa_checkLicense),$('[data-action="iaa_linkSave"]').on("click",iaa_linkSave),$('[data-action="iaa_importIA"]').on("click",function(){$("#iaa_importForm").submit()}),$('[data-action="iaa_addNewStep"]').on("click",function(){iaa_addStep(iaa_data.txt_myStep)}),$('[data-action="iaa_openWinAction"]').on("click",function(){iaa_openWinAction(jQuery(this))}),$('[data-action="iaa_openWinInteraction"]').on("click",function(){iaa_openWinInteraction(jQuery(this))})})}(jQuery);